"use strict";(globalThis["webpackChunkvnm_static_h5"]=globalThis["webpackChunkvnm_static_h5"]||[]).push([[6238],{36238:(e,n,t)=>{t.r(n),t.d(n,{default:()=>N});var o=t(61758),a=t(58790),i={class:"personal-account"},l={class:"flex items-center no-wrap"},r={class:"q-ml-md"},u={key:0,class:"text-center q-mt-md"},s={class:"q-px-lg q-pt-sm q-pb-lg"},c=["src","title"];function d(e,n,t,d,p,f){var m=(0,o.g2)("q-input"),h=(0,o.g2)("q-btn"),b=(0,o.g2)("q-form"),v=(0,o.g2)("q-toolbar-title"),g=(0,o.g2)("q-toolbar"),R=(0,o.g2)("q-card-section"),_=(0,o.g2)("q-card"),y=(0,o.g2)("q-dialog"),C=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",i,[(0,o.bF)(b,{ref:"profileFormRef"},{default:(0,o.k6)((function(){return[(0,o.Lk)("div",l,[(0,o.bF)(m,{ref:"phoneNumberRef",standout:"",class:"q-pb-xs","hide-bottom-space":"",modelValue:e.formDetails.phone,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.formDetails.phone=n}),type:"tel",label:e.$t("lang.personal_mobilenumber"),"lazy-rules":"",rules:[function(n){return n&&n.length>0||e.$t("lang.personal_mobilenumber_val")},e.isValidPhone],readonly:!e.showVerifyBtn,style:{width:"100%"}},null,8,["modelValue","label","rules","readonly"]),(0,o.Lk)("div",r,[(0,o.bF)(h,{size:"md",color:"brightbtn",label:e.showVerifyBtn&&e.otpCountdownCount<=0?e.$t("lang.personal_sendotp"):"".concat(e.$t("lang.personal_sentotp_countdown")," ").concat(e.otpCountdownCount),onClick:n[1]||(n[1]=function(n){return e.openVerificationDialog()}),style:{"white-space":"nowrap"},disable:!e.showVerifyBtn&&e.otpCountdownCount>0},null,8,["label","disable"])])]),(0,o.bF)(m,{standout:"",class:"q-pb-xs","hide-bottom-space":"",ref:"phoneOtpRef",modelValue:e.formDetails.phoneOtpRef,"onUpdate:modelValue":n[2]||(n[2]=function(n){return e.formDetails.phoneOtpRef=n}),type:"tel",label:e.$t("lang.personal_mobileotp"),"lazy-rules":"",rules:[function(n){return n&&n.length>5&&n.length<7||e.$t("lang.personal_mobileotp_val")}],style:{width:"100%"}},null,8,["modelValue","label","rules"]),e.canEdit?((0,o.uX)(),(0,o.CE)("div",u,[(0,o.bF)(h,{size:"md",color:"brightbtn",onClick:n[3]||(n[3]=function(n){return e.submitUpdateSecurity()}),label:e.$t("lang.personal_submit_btn")},null,8,["label"])])):(0,o.Q3)("",!0)]})),_:1},512)]),(0,o.bF)(y,{modelValue:e.showCaptchaDialog,"onUpdate:modelValue":n[6]||(n[6]=function(n){return e.showCaptchaDialog=n}),width:"100%","no-backdrop-dismiss":""},{default:(0,o.k6)((function(){return[(0,o.bF)(_,{width:"100%"},{default:(0,o.k6)((function(){return[(0,o.bF)(R,{class:"q-pa-md bg-brightbtn text-white"},{default:(0,o.k6)((function(){return[(0,o.bF)(g,null,{default:(0,o.k6)((function(){return[(0,o.bF)(v,null,{default:(0,o.k6)((function(){return[(0,o.eW)((0,a.v_)(e.$t("lang.personal_verification")),1)]})),_:1}),(0,o.bo)((0,o.bF)(h,{flat:"",round:"",dense:"",icon:"close"},null,512),[[C]])]})),_:1})]})),_:1}),(0,o.Lk)("div",s,[(0,o.bF)(R,{class:"q-mb-md q-pa-md"},{default:(0,o.k6)((function(){return[(0,o.bF)(m,{modelValue:e.innerCaptchaRef,"onUpdate:modelValue":n[5]||(n[5]=function(n){return e.innerCaptchaRef=n}),placeholder:e.$t("lang.personal_verification")},{append:(0,o.k6)((function(){return[(0,o.Lk)("img",{src:e.verificationImg,title:e.$t("lang.personal_verification_refresh"),style:{"margin-top":"6px",cursor:"pointer"},onClick:n[4]||(n[4]=function(){return e.getCode&&e.getCode.apply(e,arguments)})},null,8,c)]})),_:1},8,["modelValue","placeholder"])]})),_:1}),(0,o.bF)(h,{onClick:e.onCaptchaSubmit,label:e.$t("lang.personal_sendotp"),color:"brightbtn"},null,8,["onClick","label"])])]})),_:1})]})),_:1},8,["modelValue"])],64)}var p=t(38734),f=t(60455),m=t(85038),h=t.n(m),b=t(88122),v=t(43710),g=t(15868),R=t(23537);const _=(0,o.pM)({name:"PersonalView",setup:function(){var e,n=t(54760),a=(0,v.A)(),i=(0,R.s9)(),l=i.t,r=(0,f.rd)(),u=(0,p.Kh)({start:"",end:""}),s=(0,p.KR)(),c=(0,g.Z)(),d=function(){c.birthday>0&&(c.birthday=h()(c.birthday).format("YYYY-MM-DD")),B.nickName=c.nickName,B.realName=c.realName,B.birthday=c.birthday,B.email=c.email,B.phone="",B.phoneVerified=c.phoneVerified},m=(0,p.KR)(!1),_=(0,p.KR)(""),y=(0,p.Kh)({}),C=(0,p.KR)(""),K=function(){b.api.get("/member/verificationCode").then((function(e){0===e.code&&(C.value="data:image/png;base64,"+e.data.img,F.codeId=e.data.id,Y.value="")}))["catch"]((function(e){a.notify({color:"negative",position:"top",message:e.message,icon:"report_problem"})}))},V=(0,p.KR)(!1),k=(0,p.KR)(!1),w=(0,p.KR)(),F=(0,p.Kh)({mobileNumber:"",verificationCode:""}),q=(0,p.KR)(!1),D=function(){F.emailAddress="",F.verificationCode="",k.value=!0},E=function(){K(),q.value=!0},A=(0,p.KR)(),I=(0,p.KR)(),$=(0,p.KR)(),N=function(){if(O.value.validate(),$.value.validate(),$.value.hasError||O.value.hasError);else{var e="session/verifyPhoneForVNM";b.api.post(e,n.stringify({phone:B.phone,code:B.phoneOtpRef,codeId:_.value})).then((function(e){0===e.code&&(c.setPhone(B.phone),a.notify({color:"positive",position:"top",message:l("lang.personal_verification_successful"),icon:"check_circle_outline"}),c.phoneVerified=!0,c.phone=B.phone,r.go(-1))}))["catch"]((function(e){}))}},S=(0,p.KR)(!1),Q=(0,p.KR)(!1),M=(0,p.KR)(!1),x=(0,p.KR)(!1),P=(0,p.KR)(!1),B=(0,p.Kh)([]),T=(0,p.KR)(),U=(0,p.KR)(),L=(0,p.KR)(),O=(0,p.KR)(),z=(0,p.KR)(),Y=(0,p.KR)(),X=(0,p.KR)(!1),W=(0,p.KR)(!0),Z=(0,p.KR)(!1),j=function(){var e=/^(0[1-9]|[1-9])(\d{8,9})$/,n=B.phone,t=""===n?l("lang.personal_mobilenumber_verify"):!!e.test(n)||l("lang.personal_mobilenumber_val");return t},G=(0,p.KR)(0),H=function(){G.value=60,e=setInterval((function(){if(G.value<=0)return W.value=!0,void clearInterval(e);G.value--}),1e3)},J=function(){$.value.validate(),$.value.hasError||(K(),X.value=!0)},ee=function(){if(!B.phone)return a.notify({color:"negative",position:"top",message:"手机号码不能为空",icon:"report_problem"}),void K();b.api.post("/otp/sendSms",n.stringify({telephone:B.phone,captchaCode:Y.value,codeId:F.codeId})).then((function(e){K();var n=e.message||l("lang.personal_verification_successful"),t="positive";0===e.code?(m.value=!0,X.value=!1,W.value=!1,Z.value=!0,_.value=e.data.codeId,H()):(t="negative",K()),n&&a.notify({message:n,color:t})}))};return(0,o.sV)((function(){d(),K()})),{router:r,store:c,searchForm:u,updateSecurityFormRef:w,updateSecurityVerified:F,updateSecurityModal:D,updateSecurityModalVisible:k,submitUpdateSecurity:N,isEditRealName:S,isEditEmail:Q,isEditPhone:M,isEditBirthday:x,formDetails:B,profileFormRef:s,verificationModalVisible:q,openVerificationModal:E,isEmailSending:V,verificationImg:C,getCode:K,verificationDetails:y,verificationCodeRef:I,emailAddressRef:A,isEdit:P,emailRef:L,phoneOtpRef:O,realNameRef:T,birthdayRef:U,moment:h(),canEdit:m,phoneNumberRef:$,showVerificationTokenInput:Z,isValidPhone:j,captchaRef:z,innerCaptchaRef:Y,showCaptchaDialog:X,openVerificationDialog:J,onCaptchaSubmit:ee,showVerifyBtn:W,phoneCodeId:_,otpCountdownCount:G}}});var y=t(12807),C=t(21565),K=t(68926),V=t(69001),k=t(57201),w=t(97569),F=t(27066),q=t(79351),D=t(56769),E=t(79197),A=t(98582),I=t.n(A);const $=(0,y.A)(_,[["render",d]]),N=$;I()(_,"components",{QForm:C.A,QInput:K.A,QBtn:V.A,QDialog:k.A,QCard:w.A,QCardSection:F.A,QToolbar:q.A,QToolbarTitle:D.A}),I()(_,"directives",{ClosePopup:E.A})}}]);